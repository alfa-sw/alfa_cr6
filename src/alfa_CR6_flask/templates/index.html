{% extends 'admin/master.html' %}

{% block body %}
  <p></p>
  
<style>
	th, td {
	  padding: 10px;
	}

	table.status_table{
	  border: 1px solid light-grey;
	  border-collapse: collapse;
	  width: 100%;
	}

	div.scrollable {
	  background-color: #FFFFEE;
	  height: 300px;
	  overflow: auto;
	}

	div.block_container {
		background-color: #EEF7F7;
//~ 		margin-left: 30px;
//~ 		margin-right: 30px;
	}
</style>


<div class="block_container">

	<div id="server_time"></div>

	<div id="live_can_list"></div>

	<table class="status_table">

		<tr><th>A</th><th>B</th><th>C</th></tr>
		<tr>
		{% for i in (0, 2, 4) %}
		<td><div class="scrollable" id="device:machine:status_{{ i }}"> {{ i }} </div> </td>
		{% endfor %}
		</tr>

		<tr><th>F</th><th>E</th><th>D</th></tr>
		<tr>
		{% for i in (1, 3, 5) %}
		<td><div class ="scrollable" id="device:machine:status_{{ i }}"> {{ i }} </div> </td>
		{% endfor %}
		</tr>

	</table>

<input type="text" id="debug_button"></input>
<input type="submit" onclick="send_debug_button();"></input>

</div>

<script>

	var g_ws_client = null;
	
	var send_debug_button = function() {
		var el = document.getElementById("debug_button"); 
		if((el) && (g_ws_client)){
			el.value;
			console.debug('send_debug_button(), el.value: ' + el.value); 
			g_ws_client.send({"debug_button": el.value});
		}
	}

	var on_wsocket_open = function(event) {
		console.debug('on_wsocket_open, event: ' + JSON.stringify(event)); 
	};
	var on_wsocket_close =  function(event) {
		console.log('on_wsocket_close, event: ' + JSON.stringify(event)); 
	};
	var on_wsocket_error = function(event) {
		console.log('on_wsocket_error, event: ' + JSON.stringify(event));
	};
	var on_wsocket_message = function(event) {
		var data = JSON.parse(event.data);
//~ 		console.log('on_wsocket_message() data.value:', data.value)
		var data_container_id = null;
		console.log('data.type:', data.type)
		var el = document.getElementById(data.type); 
		if(el){
			el.innerHTML = data.value;
		}
		var el1 = document.getElementById('server_time'); 
		if(el1){
			el1.innerHTML = data.server_time;
		}
	};

	var connect_wsocket = function(ws_server_url) {
		console.log('connect_wsocket() ws_server_url:', ws_server_url)
		if ((g_ws_client === null) || (ws_client.readyState == 3)/* CLOSED */) {
			g_ws_client = new WebSocket(ws_server_url);
			g_ws_client.onerror = on_wsocket_error; 
			g_ws_client.onopen = on_wsocket_open;  
			g_ws_client.onclose = on_wsocket_close;
			g_ws_client.onmessage = on_wsocket_message;
			// console.log(ws_server_url +" g_ws_client: ", g_ws_client);
		} else {
			if ((g_ws_client) && (g_ws_client.readyState == 1)/* OPEN */) {
				try {
				  g_ws_client.close(); 
				}
				catch(error) {
				  console.error(error);
				  g_ws_client = null;
				}
			}
		}
		console.log('connect_wsocket() g_ws_client:', g_ws_client)
	};

	connect_wsocket("ws://{{ ws_ip_addr_and_port }}/device:machine:status");

</script>

{% endblock %}
